@model UI.Models.Dashboard.DashboardSchool
@inject BL.Factory _f

@{
    ViewData["Title"] = Model.RecA03.a06Name + ": " + Model.RecA03.a03Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@addTagHelper *, UI


<div class="form-row">
    <div class="col-auto">
        <button id="cmdToggleH11" type="button" class="btn btn-light dropdown-toggle">
            <img src="/Images/textmemo.png" />
            @_f.tra("Nástěnka")
            <span style="margin-left:10px;" class="badge badge-primary">@Model.lisH11.Count()</span>
        </button>
    </div>

    <div class="col-auto">
        <mydropdown asp-for="@Model.a03ID" datasource="@Model.lisA03" textfield="NamePlusRedizo" valuefield="pid" event_after_changevalue="change_a03id"></mydropdown>
    </div>

</div>

<div class="form-row my-2">

    <div class="col-auto">
        <label>@_f.tra("Role v instituci"):</label>
        <strong>@Model.RecJ04.j04Name</strong>
    </div>
    <div class="col-auto">
        <label>@_f.tra("Pracovat v modulu"):</label>
    </div>
    <div class="col-auto">
        <select asp-for="@Model.a10ID" class="form-control">
            @foreach (var c in Model.lisA10)
            {
                <option value="@c.pid">@c.a10Name</option>
            }
        </select>
    </div>
    @if (Model.IsAllowCreateA01)
    {
        <div class="col-auto">
            <a class="btn btn-primary" href="/a01Create/Index?a03id=@Model.a03ID&a10id=@Model.a10ID">@_f.tra("Nový záznam")</a>
        </div>
    }
</div>

<div id="divToggleH11" style="display:none;overflow:auto;max-height:50%;">
    <strong>@_f.tra("Články na nástěnce"):</strong>
    <table class="table table-sm table-hover" style="min-width:800px;">
        @foreach (var c in Model.lisH11)
        {
            <tr>
                <td>
                    @BO.BAS.ObjectDateTime2String(c.DateInsert)
                </td>
                <td>
                    @c.UserInsert
                </td>
                <td>
                    <a href="javascript:h11_info(@c.pid)">@c.h11Name</a>

                </td>

            </tr>
        }
    </table>

</div>

@if (Model.a10ID > 0)
{
    <vc:the-grid entity="a01Event" j72id="0" go2pid="0" master_entity="a03Institution" master_pid="@Model.a03ID" contextmenuflag="1" ondblclick="tg_dblclick" master_flag="" masterviewflag="3" addfilterid="school"></vc:the-grid>
}




<script type="text/javascript">
    $(document).ready(function () {


        $("#cmdToggleH11").click(function () {
            $("#divToggleH11").slideToggle();
        });


        $("#a10ID").change(function () {

            $.post("/Common/SetUserParam", { key: "DashboardSchool-a10id", value: $(this).val() }, function (data) {
                reload();

            });


        });



    });

    function change_a03id(cbx) {

        $.post("/Common/SetUserParam", { key: "DashboardSchool-a03id", value: cbx.value }, function (data) {

            reload();

        });
    }


    function reload() {

        location.replace("/Dashboard/School?a03id=" + $("#a03ID").val() + "&a10id=" + $("#a10ID").val());
    }

    function h11_info(h11id) {
        _window_open("/h11/Info?pid=" + h11id);
    }


    /*automaticky volaná událost z thegrid controlu*/
    function thegrid_handle_event(event_name, pid) {

    }

</script>