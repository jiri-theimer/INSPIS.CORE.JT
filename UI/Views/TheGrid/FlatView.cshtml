@model FsmViewModel
@inject BL.Factory _f

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    if (Model.entity == null)
    {
        return;
    }

    ViewData["Title"] = Model.entityTitle;



}


@addTagHelper *,UI

@if (Model.prefix == "a01")
{
    <table>
        <tr>
            <td>
                <myselect entity="a10EventType" asp-for="@Model.FilterA10ID" firstemptyrowtext="--@_f.tra("Typ akce")--" firstemptyrowvalue="0" textfield="a10Name" selectedvalue="@Model.FilterA10ID" selectedtext="@Model.FilterA10Name" event_after_changevalue="a10id_onchange" orderfield="a10Name" cssclass_selected="filtered"></myselect>
            </td>
            <td>
                <myselect entity="a08Theme" asp-for="@Model.FilterA08ID" firstemptyrowtext="--@_f.tra("Téma akce")--" firstemptyrowvalue="0" textfield="a08Name+isnull(' ('+a08Ident+')','')" selectedvalue="@Model.FilterA08ID" selectedtext="@Model.FilterA08Name" event_after_changevalue="a08id_onchange" orderfield="a08Name" cssclass_selected="filtered"></myselect>
            </td>
            <td>
                <select class="form-select" asp-for="@Model.FilterMyInvolvement" onchange="myinvolvement_change(this)">
                    <option value="">@("-- "+_f.tra("Mé zapojení do akce")+" --")</option>
                    <option value="involved">@_f.tra("Jsem zapojen do akce")</option>
                    <option value="leader">@_f.tra("Jsem vedoucím týmu")</option>
                    <option value="member">@_f.tra("Jsem členem týmu")</option>
                    <option value="invited">@_f.tra("Jsem přizvanou osobou v týmu")</option>
                    <option value="issuer">@_f.tra("Jsem zakladatelem akce")</option>
                </select>
            </td>
            <td>
                @Html.EditorFor(m => m.period, "~/Views/Shared/_Period.cshtml")
            </td>

        </tr>
    </table>

}
@if (Model.prefix == "h04")
{
    <table>
        <tr>           
            <td>
                <select class="form-select" asp-for="@Model.FilterMyInvolvement" onchange="myinvolvement_change(this)">
                    <option value="">@("-- "+_f.tra("Mé zapojení do úkolu")+" --")</option>
                    <option value="member">@_f.tra("Jsem řešitelem úkolu")</option>
                    <option value="issuer">@_f.tra("Jsem zakladatel úkolu")</option>
                </select>
            </td>
            <td>
                @Html.EditorFor(m => m.period, "~/Views/Shared/_Period.cshtml")
            </td>
        </tr>
    </table>
    
}

<vc:the-grid input="@Model.gridinput"></vc:the-grid>





@section Scripts{

    <script type="text/javascript">
    $(document.body).css("overflow", "hidden");

    $(document).ready(function () {

        if ($("#FilterMyInvolvement").val() != "") {
            $("#FilterMyInvolvement").addClass("filtered");
        }

        @if(Model.period != null)
        {
        <text>
        $("#PeriodValue").on("change", function () {
            $.post("/Common/SetUserParam", { key: "grid-period-value-@Model.prefix",value:$(this).val()  }, function (data) {
                reload();

            });
        });

        if ($("#PeriodValue").val() != "0" && $("#PeriodValue").val() != "") {
            $("#PeriodValue").css("background-color", "red");
        }

        $("#cmdRefreshPeriod").on("click", function () {
            var k = [];
            var v = [];
            k.push("grid-period-value-@Model.prefix");
            v.push($("#PeriodValue").val());
            k.push("grid-period-d1-@Model.prefix");
            v.push($("#d1helper").val());
            k.push("grid-period-d2-@Model.prefix");
            v.push($("#d2helper").val());

            $.post("/Common/SetUserParams", { keys: k, values:v  }, function (data) {
                reload();

            });

        });

        </text>
        }


        _mainmenu_highlight_current("cmd@(Model.prefix.ToUpper())");


    });

        function reload() {
            _showloading();
            location.replace("/TheGrid/FlatView?prefix=@Model.prefix");

        }



        function change_grid(j72id) {
            $.post("/Common/SetUserParam", { key: "flatview-j72id-@(Model.prefix)",value:j72id  }, function (data) {
                reload();

            });
        }

        function report_nocontext(x31id) {
            _window_open("/x31/ReportNoContext?x31id=" + x31id, 2);
        }
        function a10id_onchange(cbx) {                        
            $.post("/Common/SetUserParams", { keys: ["grid-filter-a10id", "grid-filter-a10name"], values: [cbx.value, cbx.options[cbx.selectedIndex].text]  }, function (data) {
                reload();
            });
        }
        function a08id_onchange(cbx) {
            $.post("/Common/SetUserParams", { keys: ["grid-filter-a08id", "grid-filter-a08name"], values: [cbx.value, cbx.options[cbx.selectedIndex].text] }, function (data) {
                reload();
            });
        }
        function myinvolvement_change(cbx) {
            $.post("/Common/SetUserParam", { key: "grid-filter-myinvolvement-@Model.prefix", value: cbx.value }, function (data) {
                reload();
            });
        }

        function reload() {  
            _showloading();
            location.replace("/TheGrid/FlatView?prefix=@Model.prefix");
        }

        function switch_to_master(prefix) {    //zapnout spodní panel
            $.post("/Common/SetUserParam", { key: "grid-" + prefix + "-show11", value: "1" }, function (data) {
                location.replace("/TheGrid/MasterView?prefix=" + prefix);

            });

        }
    </script>

}

